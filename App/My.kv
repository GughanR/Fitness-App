#:import get_color_from_hex kivy.utils.get_color_from_hex
#:import resource_find kivy.resources
#:import MDTextField1 kivy_modified.textfield
# ^ USING CUSTOM DEFINED TEXTFIELD AS DEFAULT HAS A BUG

#:set btnSize [0.85, 0.08]
#:set btnX (1-btnSize[0])/2

#:set tInpSize [0.8, 0.07]
#:set tInpX (1-tInpSize[0])/2

###############

###############

<Widget>:
    font_size: 50


<MDLabel>:
    color: 0,0,0,1

<MDFillRoundFlatButton>:
    md_bg_color: 0,0,0,1

<MDTextFieldCustom>:
    fill_color_normal: 1,1,1,0.3
    helper_text_color_normal: 0,0,0,1
    opacity: 1
    font_size: 40
    icon_left_color_normal: 0,0,0,0.6


<BackButton@MDIconButton>:
    pos_hint: {"x": 0.02, "y": 0.9 }
    size_hint: 0.2, 0.05
    icon: "arrow-left"
    icon_size: 50

<Background>:
    canvas:
        Color:
            rgba: get_color_from_hex("#5a57fa"+"ff")
        Rectangle:
            size: self.size
            pos: self.pos

    Image:
        source: "Images/gradient.png"
        allow_stretch: True
        keep_ratio: False
        size: self.width, self.height

<InitialScreenDecoration>:
    canvas:
        Color:
            rgba:
                0,0,0,1
        Rectangle:
            size: ((self.width * btnSize[0]/2)-40), 2
            pos: (self.width * btnX), (self.height * 0.314)
        Rectangle:
            size: ((self.width * btnSize[0]/2)-40), 2
            pos: ((self.width * 0.5)+40), (self.height * 0.314)

<TitleLine@Widget>:
    size: 100, 10
    height: 100
    canvas:
        Color:
            rgba:
                0,0,0,1
        Rectangle:
            pos: self.x, self.y+50
            size: self.width, 2

<InitialScreen>:

    FloatLayout:

        canvas:
            Color:
                rgba:
                    0,0,0,1
            Rectangle:
                size: (self.width * 0.375), 2
                pos: (self.width * 0.075), (self.height * 0.314)
            Rectangle:
                size: (self.width * 0.375), 2
                pos: (self.width * 0.55), (self.height * 0.314)

        Background
        InitialScreenDecoration

        Image:
            source: "Images/dumbbell.png"
            pos_hint: {"x": 0.2, "y": 0.7 }
            size_hint: 0.6, 0.1
            allow_stretch: True
        MDLabel:
            pos_hint: {"x": 0.05, "y": 0.55 }
            size_hint: 0.9, 0.2
            text: "AI FITNESS"
            halign: "center"
            font_size: 100
            color: 0,0,0,1

        MDLabel:
            size_hint: 0.9, 0.07
            pos_hint: {"x": 0.05, "y": 0.28}
            text: "OR"
            halign: "center"
            font_size: 40
            color: (0,0,0,1)

        MDFillRoundFlatButton:
            size_hint: btnSize
            pos_hint: {"x": btnX, "y": 0.35}
            text: "Login"
            font_size: 50
            on_release:
                root.manager.transition.direction = "left"
                root.manager.current = "login"

        MDFillRoundFlatButton:
            size_hint: btnSize
            pos_hint: {"x": btnX, "y": 0.2}
            text: "Sign Up"
            font_size: 50
            on_release:
                root.manager.transition.direction = "left"
                root.manager.current = "signup"


<LoginScreen>:

    loginBtn: loginBtn
    unInput: unInput
    pwInput: pwInput

    Background

    FloatLayout:

        Image:
            source: "Images/dumbbell.png"
            pos_hint: {"x": 0.2, "y": 0.7 }
            size_hint: 0.6, 0.1
            allow_stretch: True

        MDLabel:  # Delete
            pos_hint: {"x": 0.05, "y": 0.55 }
            size_hint: 0.9, 0.2
            text: ""
            halign: "center"
            font_size: 100
            color: 0,0,0,1

        BackButton:
            on_release:
                root.reset_inputs()
                root.manager.transition.direction = "right"
                root.manager.current = "initial"

        MDLabel:  # Delete
            pos_hint: {"x": 0.05, "y": 0.7 }
            size_hint: 0.9, 0.2
            text: ""
            halign: "left"
            font_size: 150

        MDFillRoundFlatButton:
            id: loginBtn
            size_hint: btnSize
            pos_hint: {"x": btnX, "y": 0.2}
            text: "Login"
            font_size: 50
            md_bg_color: 0,0,0,1
            on_release: root.login()

        MDTextFieldCustom:
            id: unInput
            required: True
            size_hint: tInpSize
            pos_hint: {"x": tInpX, "y": 0.5}
            hint_text: "Username / Email"
            helper_text_mode: "on_error"
            mode: "round"
            icon_left: "account-circle"

        MDTextFieldCustom:
            id: pwInput
            required: True
            size_hint: tInpSize
            pos_hint: {"x": tInpX, "y": 0.4}
            hint_text: "Password"
            password: True
            helper_text_mode: "on_error"
            mode: "round"
            icon_left: "key-variant"
            icon_left_color: "Blue"

        MDFlatButton:
            size_hint: 0,0
            pos_hint: {"x": tInpX, "y": 0.33}
            font_size: 40
            halign: "left"
            text: "[u]Forgot password?[/u]"
            markup: True
            on_release:
                root.manager.transition.direction = "left"
                root.manager.current = "forgot"



<SignUpScreen>:

    createAccountBtn: createAccountBtn
    nameInput: nameInput
    emailInput: emailInput
    unInput: unInput
    pwInput: pwInput

    Background

    FloatLayout:

        Image:
            source: "Images/dumbbell.png"
            pos_hint: {"x": 0.2, "y": 0.75 }
            size_hint: 0.6, 0.1
            allow_stretch: True

        BackButton:
            on_release:
                root.reset_inputs()
                root.manager.transition.direction = "right"
                root.manager.current = "initial"


        MDLabel:
            pos_hint: {"x": 0.05, "y": 0.7 }
            size_hint: 0.9, 0.2
            text: ""
            halign: "left"
            font_size: 150

        MDFillRoundFlatButton:
            id: createAccountBtn
            size_hint: btnSize
            pos_hint: {"x": btnX, "y": 0.15}
            text: "Sign Up"
            on_release: root.create_account()

        MDTextFieldCustom:
            id: nameInput
            required: True
            size_hint: tInpSize
            pos_hint: {"x": tInpX, "y": 0.6}
            hint_text: "Name"
            helper_text_mode: "persistent"
            helper_text_color_normal: 1,0,0,1
            mode: "round"
            icon_left: "human-child"

        MDTextFieldCustom:
            id: emailInput
            required: True
            size_hint: tInpSize
            pos_hint: {"x": tInpX, "y": 0.5}
            hint_text: "Email"
            helper_text_mode: "persistent"
            helper_text_color_normal: 1,0,0,1
            mode: "round"
            icon_left: "email"

        MDTextFieldCustom:
            id: unInput
            required: True
            size_hint: tInpSize
            pos_hint: {"x": tInpX, "y": 0.4}
            hint_text: "Username"
            helper_text_mode: "persistent"
            helper_text_color_normal: 1,0,0,1
            mode: "round"
            icon_left: "account"

        MDTextFieldCustom:
            id: pwInput
            required: True
            size_hint: tInpSize
            pos_hint: {"x": tInpX, "y": 0.3}
            hint_text: "Password"
            password: True
            helper_text_mode: "persistent"
            helper_text_color_normal: 1,0,0,1
            mode: "round"
            icon_left: "key-variant"
    

<VerifyUserScreen>:

    codeInput: codeInput
    # nameInput: nameInput
    # emailInput: emailInput
    # unInput: unInput
    # pwInput: pwInput

    FloatLayout:

        Background

        BackButton:
            on_release:
                root.reset_inputs()
                root.manager.transition.direction = "right"
                root.manager.current = "signup"

        Image:
            source: "Images/dumbbell.png"
            pos_hint: {"x": 0.2, "y": 0.65 }
            size_hint: 0.6, 0.1
            allow_stretch: True

        MDFillRoundFlatButton:
            size_hint: btnSize
            pos_hint: {"x": btnX, "y": 0.25}
            text: "Verify"
            font_size: 50
            md_bg_color: 0,0,0,1
            on_release: root.verify()

        MDTextFieldCustom:
            id: codeInput
            required: True
            size_hint: tInpSize
            pos_hint: {"x": tInpX, "y": 0.4}
            hint_text: "Verification code"
            helper_text_mode: "persistent"
            helper_text_color_normal: 1,0,0,1
            mode: "round"

<ForgotPasswordScreen>:

    FloatLayout:

        Background

        BackButton:
            on_release:
                root.reset_inputs()
                root.manager.transition.direction = "right"
                root.manager.current = "login"

        Image:
            source: "Images/dumbbell.png"
            pos_hint: {"x": 0.2, "y": 0.65 }
            size_hint: 0.6, 0.1
            allow_stretch: True

        MDFillRoundFlatButton:
            size_hint: btnSize
            pos_hint: {"x": btnX, "y": 0.25}
            text: "Reset Password"
            font_size: 50
            md_bg_color: 0,0,0,1
            on_release: root.reset_password(emailInput.text)

        MDTextFieldCustom:
            id: emailInput
            required: True
            size_hint: tInpSize
            pos_hint: {"x": tInpX, "y": 0.4}
            hint_text: "Email"
            helper_text_mode: "on_error"
            mode: "round"
            icon_left: "email"

<MainScreen>:

    MDBottomNavigation:
        panel_color: "#ffffff"
        text_color_active: "#5542ff"
        selected_color_background: "#5542ff"

        MDBottomNavigationItem:
            name: "ViewProgress"
            text: "Progress"
            icon: "finance"

            MDLabel:
                text: ""
                halign: "center"

        MDBottomNavigationItem:
            name: "Workout"
            text: "Workout"
            icon: "weight-lifter"

            MDLabel:
                text: ""
                halign: "center"

        MDBottomNavigationItem:
            name: "Account"
            text: "Account"
            icon: "account-cog"

            AccountPage


<AccountPage>:
    nameInput: nameInput
    emailInput: emailInput
    unInput: unInput
    updateBtn: updateBtn

    bg_dark: "#eeeeee"

    MDGridLayout:
        adaptive_height: True
        cols: 1
        padding: 20, 40
        spacing: 20
        #row_default_height: 80  

        AnchorLayout:  # Move button to right
            anchor_x: "right"
            MDIconButton:
                #pos_hint: {"x": 0.78, "y": 0.9 }
                icon: "refresh"
                halign: "right"
                on_release: root.refresh()
                #icon_size: 50  

        MDLabel:
            text: "Account Details"
            halign: "left"
            font_size: 60
            adaptive_height: True

        #TitleLine
        MDSeparator:
            row_height: 10

        MDTextField:
            id: nameInput
            hint_text: "Name"
            mode: "rectangle"
            text: root.nameText
            helper_text_mode: "persistent"
            helper_text_color_normal: 1,0,0,1

        MDTextField:
            id: emailInput
            hint_text: "Email Address"
            mode: "rectangle"
            text: root.emailText
            helper_text_mode: "persistent"
            helper_text_color_normal: 1,0,0,1

        MDTextField:
            id: unInput
            hint_text: "Username"
            mode: "rectangle"
            text: root.unText
            helper_text_mode: "persistent"
            helper_text_color_normal: 1,0,0,1

        MDFillRoundFlatButton:
            id: updateBtn
            size_hint: btnSize
            pos_hint: {"x": btnX, "y": 0.25}
            text: "Update Details"
            font_size: 50
            md_bg_color: 0,0,0,1
            on_release: root.update_account()

        MDFillRoundFlatButton:
            size_hint: btnSize
            pos_hint: {"x": btnX, "y": 0.25}
            text: "Change Password"
            font_size: 50
            md_bg_color: 0,0,0,1
