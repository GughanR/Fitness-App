#:import get_color_from_hex kivy.utils.get_color_from_hex
#:import resource_find kivy.resources
#:import MDTextField1 kivy_modified.textfield
# ^ USING CUSTOM DEFINED TEXTFIELD AS DEFAULT HAS A BUG

# Set button/text input sizes
#:set btnSize [0.85, 0.08]
#:set btnX (1-btnSize[0])/2

#:set tInpSize [0.8, 0.07]
#:set tInpX (1-tInpSize[0])/2

###############

###############

<MDLabel>:
    color: 0,0,0,1
    font_size: app.fs_normal

<MDFillRoundFlatButton>:
    md_bg_color: 0,0,0,1

<MDTextFieldCustom>:
    fill_color_normal: 1,1,1,0.3
    helper_text_color_normal: 0,0,0,1
    opacity: 1
    font_size: app.fs_normal
    icon_left_color_normal: 0,0,0,0.6

<MDTextField>:
    font_size: app.fs_normal

<BackButton@MDIconButton>:
    pos_hint: {"x": 0.02, "y": 0.9 }
    size_hint: 0.2, 0.05
    icon: "arrow-left"
    icon_size: app.fs_normal

<Background>:
    canvas:
        Color:
            rgba: get_color_from_hex("#5a57fa"+"ff")
        Rectangle:
            size: self.size
            pos: self.pos

    Image:
        source: "Images/gradient.png"
        allow_stretch: True
        keep_ratio: False
        size: self.width, self.height

<InitialScreenDecoration>:
    canvas:
        Color:
            rgba:
                0,0,0,1
        Rectangle:
            size: ((self.width * btnSize[0]/2)-40), 2
            pos: (self.width * btnX), (self.height * 0.314)
        Rectangle:
            size: ((self.width * btnSize[0]/2)-40), 2
            pos: ((self.width * 0.5)+40), (self.height * 0.314)

<TitleLine@Widget>:
    size: 100, 10
    height: 100
    canvas:
        Color:
            rgba:
                0,0,0,1
        Rectangle:
            pos: self.x, self.y+50
            size: self.width, 2

<DialogBtn>:
    text: "OK"
    font_size: app.fs_normal
    on_release: root.parent.parent.parent.parent.dismiss()

<InitialScreen>:

    FloatLayout:

        canvas:
            Color:
                rgba:
                    0,0,0,1
            Rectangle:
                size: (self.width * 0.375), 2
                pos: (self.width * 0.075), (self.height * 0.314)
            Rectangle:
                size: (self.width * 0.375), 2
                pos: (self.width * 0.55), (self.height * 0.314)

        Background
        InitialScreenDecoration

        Image:
            source: "Images/dumbbell.png"
            pos_hint: {"x": 0.2, "y": 0.7 }
            size_hint: 0.6, 0.1
            allow_stretch: True
        MDLabel:
            pos_hint: {"x": 0.05, "y": 0.55 }
            size_hint: 0.9, 0.2
            text: "AI FITNESS"
            halign: "center"
            font_size: app.fs_title
            color: 0,0,0,1

        MDLabel:
            size_hint: 0.9, 0.07
            pos_hint: {"x": 0.05, "y": 0.28}
            text: "OR"
            halign: "center"
            font_size: app.fs_normal
            color: (0,0,0,1)

        MDFillRoundFlatButton:
            size_hint: btnSize
            pos_hint: {"x": btnX, "y": 0.35}
            text: "Login"
            font_size: app.fs_normal
            on_release:
                root.manager.transition.direction = "left"
                root.manager.current = "login"

        MDFillRoundFlatButton:
            size_hint: btnSize
            pos_hint: {"x": btnX, "y": 0.2}
            text: "Sign Up"
            font_size: app.fs_normal
            on_release:
                root.manager.transition.direction = "left"
                root.manager.current = "signup"


<LoginScreen>:

    loginBtn: loginBtn
    unInput: unInput
    pwInput: pwInput

    Background

    FloatLayout:

        Image:
            source: "Images/dumbbell.png"
            pos_hint: {"x": 0.2, "y": 0.7 }
            size_hint: 0.6, 0.1
            allow_stretch: True

        BackButton:
            on_release:
                root.reset_inputs()
                root.manager.transition.direction = "right"
                root.manager.current = "initial"

        MDFillRoundFlatButton:
            id: loginBtn
            size_hint: btnSize
            pos_hint: {"x": btnX, "y": 0.2}
            text: "Login"
            font_size: app.fs_normal
            md_bg_color: 0,0,0,1
            on_release: root.login()

        MDTextFieldCustom:
            id: unInput
            required: True
            size_hint: tInpSize
            pos_hint: {"x": tInpX, "y": 0.5}
            hint_text: "Username / Email"
            helper_text_mode: "on_error"
            mode: "round"
            icon_left: "account-circle"

        MDTextFieldCustom:
            id: pwInput
            required: True
            size_hint: tInpSize
            pos_hint: {"x": tInpX, "y": 0.4}
            hint_text: "Password"
            password: True
            helper_text_mode: "on_error"
            mode: "round"
            icon_left: "key-variant"
            icon_left_color: "Blue"

        MDFlatButton:
            size_hint: 0,0
            pos_hint: {"x": tInpX, "y": 0.33}
            font_size: app.fs_normal
            halign: "left"
            text: "[u]Forgot password?[/u]"
            markup: True
            on_release:
                root.manager.transition.direction = "left"
                root.manager.current = "forgot"



<SignUpScreen>:

    createAccountBtn: createAccountBtn
    nameInput: nameInput
    emailInput: emailInput
    unInput: unInput
    pwInput: pwInput

    Background

    FloatLayout:

        Image:
            source: "Images/dumbbell.png"
            pos_hint: {"x": 0.2, "y": 0.75 }
            size_hint: 0.6, 0.1
            allow_stretch: True

        BackButton:
            on_release:
                root.reset_inputs()
                root.manager.transition.direction = "right"
                root.manager.current = "initial"

        MDFillRoundFlatButton:
            id: createAccountBtn
            size_hint: btnSize
            pos_hint: {"x": btnX, "y": 0.15}
            text: "Sign Up"
            font_size: app.fs_normal
            on_release: root.create_account()

        MDTextFieldCustom:
            id: nameInput
            required: True
            size_hint: tInpSize
            pos_hint: {"x": tInpX, "y": 0.6}
            hint_text: "Name"
            helper_text_mode: "persistent"
            helper_text_color_normal: 1,0,0,1
            mode: "round"
            icon_left: "human-child"

        MDTextFieldCustom:
            id: emailInput
            required: True
            size_hint: tInpSize
            pos_hint: {"x": tInpX, "y": 0.5}
            hint_text: "Email"
            helper_text_mode: "persistent"
            helper_text_color_normal: 1,0,0,1
            mode: "round"
            icon_left: "email"

        MDTextFieldCustom:
            id: unInput
            required: True
            size_hint: tInpSize
            pos_hint: {"x": tInpX, "y": 0.4}
            hint_text: "Username"
            helper_text_mode: "persistent"
            helper_text_color_normal: 1,0,0,1
            mode: "round"
            icon_left: "account"

        MDTextFieldCustom:
            id: pwInput
            required: True
            size_hint: tInpSize
            pos_hint: {"x": tInpX, "y": 0.3}
            hint_text: "Password"
            password: True
            helper_text_mode: "persistent"
            helper_text_color_normal: 1,0,0,1
            mode: "round"
            icon_left: "key-variant"
    

<VerifyUserScreen>:

    codeInput: codeInput
    # nameInput: nameInput
    # emailInput: emailInput
    # unInput: unInput
    # pwInput: pwInput

    FloatLayout:

        Background

        BackButton:
            on_release:
                root.reset_inputs()
                root.manager.transition.direction = "right"
                root.manager.current = "signup"

        Image:
            source: "Images/dumbbell.png"
            pos_hint: {"x": 0.2, "y": 0.65 }
            size_hint: 0.6, 0.1
            allow_stretch: True

        MDFillRoundFlatButton:
            size_hint: btnSize
            pos_hint: {"x": btnX, "y": 0.25}
            text: "Verify"
            font_size: app.fs_normal
            md_bg_color: 0,0,0,1
            on_release: root.verify()

        MDTextFieldCustom:
            id: codeInput
            required: True
            size_hint: tInpSize
            pos_hint: {"x": tInpX, "y": 0.4}
            hint_text: "Verification code"
            helper_text_mode: "persistent"
            helper_text_color_normal: 1,0,0,1
            mode: "round"

<ForgotPasswordScreen>:

    FloatLayout:

        Background

        BackButton:
            on_release:
                root.reset_inputs()
                root.manager.transition.direction = "right"
                root.manager.current = "login"

        Image:
            source: "Images/dumbbell.png"
            pos_hint: {"x": 0.2, "y": 0.65 }
            size_hint: 0.6, 0.1
            allow_stretch: True

        MDFillRoundFlatButton:
            size_hint: btnSize
            pos_hint: {"x": btnX, "y": 0.25}
            text: "Reset Password"
            font_size: 50
            md_bg_color: 0,0,0,1
            on_release: root.reset_password(emailInput.text)

        MDTextFieldCustom:
            id: emailInput
            required: True
            size_hint: tInpSize
            pos_hint: {"x": tInpX, "y": 0.4}
            hint_text: "Email"
            helper_text_mode: "on_error"
            mode: "round"
            icon_left: "email"

<MainScreen>:

    MDBottomNavigation:
        panel_color: "#ffffff"
        text_color_active: "#5542ff"
        selected_color_background: "#5542ff"

        MDBottomNavigationItem:
            name: "ViewProgress"
            text: "Progress"
            icon: "finance"

            MDLabel:
                text: ""
                halign: "center"

        MDBottomNavigationItem:
            name: "Workout"
            text: "Workout"
            icon: "weight-lifter"

            WorkoutPage

        MDBottomNavigationItem:
            name: "Account"
            text: "Account"
            icon: "account-cog"

            AccountPage


<AccountPage>:
    nameInput: nameInput
    emailInput: emailInput
    unInput: unInput
    updateBtn: updateBtn
    weightUnitDropDown: weightUnitDropDown

    bg_dark: "#eeeeee"

    MDGridLayout:
        adaptive_height: True
        cols: 1
        padding: 40, 20
        spacing: 40

        AnchorLayout:  # Move button to right
            anchor_x: "right"
            MDIconButton:
                icon: "refresh"
                halign: "right"
                on_release: root.refresh()
                icon_size: app.fs_normal  

        MDFillRoundFlatButton:
            id: logoutBtn
            size_hint: btnSize
            pos_hint: {"x": btnX, "y": 0.25}
            text: "Logout"
            font_size: app.fs_normal
            md_bg_color: app.accent_colour
            on_release: root.logout()

        MDSeparator

        MDLabel:
            text: "Account Details"
            halign: "left"
            font_size: app.fs_heading
            adaptive_height: True

        MDSeparator

        MDTextField:
            id: nameInput
            hint_text: "Name"
            mode: "rectangle"
            text: root.nameText
            helper_text_mode: "persistent"
            helper_text_color_normal: 1,0,0,1

        MDTextField:
            id: emailInput
            hint_text: "Email Address"
            mode: "rectangle"
            text: root.emailText
            helper_text_mode: "persistent"
            helper_text_color_normal: 1,0,0,1

        MDTextField:
            id: unInput
            hint_text: "Username"
            mode: "rectangle"
            text: root.unText
            helper_text_mode: "persistent"
            helper_text_color_normal: 1,0,0,1

        MDLabel

        MDFillRoundFlatButton:
            id: updateBtn
            size_hint: btnSize
            pos_hint: {"x": btnX, "y": 0.25}
            text: "Update Details"
            font_size: app.fs_normal
            md_bg_color: 0,0,0,1
            on_release: root.update_account()

        MDFillRoundFlatButton:
            size_hint: btnSize
            pos_hint: {"x": btnX, "y": 0.25}
            text: "Change Password"
            font_size: app.fs_normal
            md_bg_color: 0,0,0,1
            on_release: 
                # Kivy is a frustrating language
                # Need to traverse back 4 times to change screen
                # AccountPage --> MDBottomNavigationItem --> ScreenManager 
                # --> MDBottomNavigationItem --> MainScreen
                root.parent.parent.parent.parent.manager.transition.direction = "left"
                root.parent.parent.parent.parent.manager.current = "password"

        MDLabel
        MDLabel:
            text: "App Preferences"
            halign: "left"
            font_size: app.fs_heading
            adaptive_height: True

        MDSeparator
        MDBoxLayout:
            padding: 0, -20
            cols: 2
            MDLabel:
                text: "Weight Unit:"
                adaptive_height: True
            MDDropDownItem:
                id: weightUnitDropDown
                text: "KG"
                font_size: app.fs_normal
                on_release: root.show_drop_down()
        MDLabel

<ChangePasswordScreen>:

    FloatLayout:

        MDLabel:
            pos_hint: {"x": 0.1, "y": 0.7 }
            size_hint: 0.8, 0.2
            text: "Change Password"
            halign: "left"
            valign: "top"
            font_size: app.fs_heading
            color: 0,0,0,1

        BackButton:
            on_release:
                root.reset_inputs()
                root.manager.transition.direction = "right"
                root.manager.current = "main"

        MDTextField:
            id: oldPWInput
            hint_text: "Old Password"
            size_hint: 0.8, 0.1
            pos_hint: {"x": 0.1, "y": 0.55}
            mode: "rectangle"
            helper_text_mode: "persistent"
            helper_text_color_normal: 1,0,0,1
            font_size: app.fs_normal

        MDTextField:
            id: newPWInput
            hint_text: "New Password"
            size_hint: 0.8, 0.1
            pos_hint: {"x": 0.1, "y": 0.4}
            mode: "rectangle"
            helper_text_mode: "persistent"
            helper_text_color_normal: 1,0,0,1
            font_size: app.fs_normal

        MDFillRoundFlatButton:
            id: updateBtn
            size_hint: btnSize
            pos_hint: {"x": btnX, "y": 0.2}
            text: "Update"
            font_size: 50
            md_bg_color: 0,0,0,1
            on_release: root.update_account()

<WorkoutPage>:

    MDGridLayout:

        adaptive_height: True
        cols: 1
        padding: 40, 20
        spacing: 40

        AnchorLayout:  # Move button to right
            anchor_x: "right"
            MDIconButton:
                icon: "refresh"
                halign: "right"
                #on_release: root.refresh()
                icon_size: app.fs_normal  
        MDLabel:
            text: "Your Workouts"
            halign: "center"
            font_size: app.fs_heading
            adaptive_height: True
        MDSeparator
        MDFillRoundFlatButton:
            text: "+ New Workout"
            font_size: app.fs_normal
            md_bg_color: app.accent_colour
            size_hint: btnSize
            on_release: root.new_workout()

<CreateWorkoutScreen>:
    goalDropDown: goalDropDown
    typeDropDown: typeDropDown

    MDFloatLayout:
        BackButton:
            on_release:
                root.manager.transition.direction = "right"
                root.manager.current = "main"
        MDLabel:
            text: "Plan Goal:"
            size_hint: tInpSize
            pos_hint: {"x":tInpX, "y": 0.8}
            font_size:  app.fs_normal
        MDDropDownItem:
            size_hint: [0.3, 0.1]
            pos_hint: {"x":1-0.3-tInpX, "y": 0.81}
            id: goalDropDown
            text: "Size"
            font_size: app.fs_normal
            on_release: root.show_goal_drop_down()
        MDLabel:
            text: "Plan Type:"
            size_hint: tInpSize
            pos_hint: {"x":tInpX, "y": 0.7}
            font_size:  app.fs_normal
        MDDropDownItem:
            size_hint: [0.45, 0.1]
            pos_hint: {"x":1-0.45-tInpX, "y": 0.71}
            id: typeDropDown
            text: "Full Body"
            font_size: app.fs_normal
            on_release: root.show_type_drop_down()
        MDTextField:
            id: planNameInput
            hint_text: "Workout Plan Name"
            size_hint: 0.8, 0.1
            pos_hint: {"x": 0.1, "y": 0.55}
            mode: "rectangle"
            helper_text_mode: "persistent"
            helper_text_color_normal: 1,0,0,1
            font_size: app.fs_normal
        MDBoxLayout:
            pos_hint: {"x": 0.1, "y": 0.5}
            size_hint: [0.8, 0.5]
            spacing: 8
            MDChip:
                text: "Chest"
                active: True
            MDChip:
                text: "Shoulders"
                active: True
        MDBoxLayout:
            pos_hint: {"x": 0.1, "y": 0.45}
            size_hint: [0.8, 0.5]
            spacing: 8
            MDChip:
                text: "Triceps"
                active: True
            MDChip:
                text: "Back"
                active: True
        MDBoxLayout:
            pos_hint: {"x": 0.1, "y": 0.4}
            size_hint: [0.8, 0.5]
            spacing: 8
            MDChip:
                text: "Biceps"
                active: True
            MDChip:
                text: "Forearms"
                active: True
        MDBoxLayout:
            pos_hint: {"x": 0.1, "y": 0.35}
            size_hint: [0.8, 0.5]
            spacing: 8
            MDChip:
                text: "Quadriceps"
                active: True
        MDBoxLayout:
            pos_hint: {"x": 0.1, "y": 0.3}
            size_hint: [0.8, 0.5]
            spacing: 8
            MDChip:
                text: "Glutes"
                active: True
            MDChip:
                text: "Hamstrings"
                active: True
        MDBoxLayout:
            pos_hint: {"x": 0.1, "y": 0.25}
            size_hint: [0.8, 0.5]
            spacing: 8
            MDChip:
                text: "Calves"
                active: True
            MDChip:
                text: "Abdominals"
                active: True
        MDFillRoundFlatButton:
            size_hint: btnSize
            pos_hint: {"x": btnX, "y": 0.1}
            text: "Create Workout Plan"
            font_size: app.fs_normal
            md_bg_color: app.accent_colour
            on_release:
                root.create_workout_plan()


#        MDBoxLayout:
#            padding: 0, -20
#            cols: 2
#            MDLabel:
#                text: "Weight Unit:"
#                adaptive_height: True
#            MDDropDownItem:
#                id: weightUnitDropDown
#                text: "KG"
#                font_size: app.fs_normal
#                on_release: root.show_drop_down()

